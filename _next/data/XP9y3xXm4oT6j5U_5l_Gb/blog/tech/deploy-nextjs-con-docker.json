{"pageProps":{"results":[{"id":18,"title":"Deploy de NextJS en Docker con NGINX","description":"Esta etrada explico el proceso de hacer un deployment de una aplicación connstruida con nextJS utilizando Docker y NGINX.","content":"\n## 1. Linode\n\nPara este proyecto voy a utilizar una VM de Linode. Ya que la generamos tomamos el IP y nos conectamos a la VM a través de VS Code. Yo utilizo un plugin llamado `Remote Explorer` para hacer esto.\n\n## 2. Docker\nYa que tenemos acceso a nuestra VM, debemos de instalar Docker. Docker es nos ayuda a crear contendores para nuestras aplicaciones.\n\n```shell\n sudo apt-get update\n sudo apt-get install \\\n    ca-certificates \\\n    curl \\\n    gnupg \\\n    lsb-release\n\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n\necho \\\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\\n  $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n\n sudo apt-get update\n sudo apt-get install docker-ce docker-ce-cli containerd.io\n\n sudo curl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n\nsudo chmod +x /usr/local/bin/docker-compose\n\ndocker-compose --version\n```\n## 4 Node\n\n```shell\ncurl -fsSL https://deb.nodesource.com/setup_current.x | sudo -E bash -\nsudo apt-get install -y nodejs\nnpm install --global yarn\n```\n\n## 5 nextJS\n\n```shell\nnpx create-next-app -e with-tailwindcss ejemplo-blog\n```\n\n### 5.1 Estilos de Markdown\n[**Este**](https://github.com/sindresorhus/github-markdown-css) repo de Github contiene los archivos necesarios para agregarle estilo a un archivo de markdown. Especificamente para este ejemplo, utilice el archivo llamado `github-markdown.css`\n\nAdicional, para agregar color a los bloques de código escritos con markdown (a lo que se le conoce como highlight syntax) utilizaremos la librería [**Prism**](https://prismjs.com/). Existen muchos paquetes que se basan en esta libería. Este proyecto, al ser de React, puede aprovecharse de esta librería: \n\n```shell\nyarn add prismjs\n```\n\nNuestro CMS regresa unn *string* de texto en formato *markdown* para este sitio tenemos que tomar esta información y connvertirla en HTML. Para este proceos (que se le conoce como *parsing*), utilizaremos un paquete que se llama ´next-mdx-remote´  que esta basado en la popular librería de markdown [MDX](https://mdxjs.com/docs/getting-started/). \n\nEste es el paquete:\n\n```shell\nyarn add next-mdx-remote\n````\n\n#### 5.1.1 Agregar Prsim a nuestro archivo\nEn el archivo `_app.js` agregar lo siguiente\n\n```js\n//_app.js\n\nimport \"prismjs/themes/prism.css\";\n```\n\n### 5.2 Componentes\nEsta es la estructura básica de archivos con la que estaremos trabajando en este proyecto.\n\n```\n+-- components\n|   └-- Blogcard.js\n└-- pages\n|   └-- blog\n|   |  └-- [postid].js\n|   |  └-- markdown-styles.module.css\n|   └-- index.js\n|   └-- _app.js\n```\nCrearemos una carpeta que se llama `components`.\n\n### 5.3 Creando archivos de forma dinámica\nNextJS permite crear páginas de forma dinámica. En nuestro caso, vamos a tener todos los artículos de nuestro blog en un CMS, y vamos a generar una página por artículo.\nEn nuestra estructura de archivos, tenemos un archivo llamado `[postid].js` dentro de este archvio colocamos el siguiente código.\n\n```js\n//[postid].js\nimport markdownStyles from './markdown-styles.module.css'\nimport {serialize} from \"next-mdx-remote/serialize\"\nimport { MDXRemote } from \"next-mdx-remote\"\nimport { useEffect } from \"react\"\n\nconst prism = require(\"prismjs\")\nrequire(\"prismjs/components/prism-python\")\nrequire(\"prismjs/components/prism-bash\")\nrequire(\"prismjs/components/prism-json\")\n\nexport default function Movies({results,source}) {\n\n    useEffect(()=>{\n        console.log(\"using effect\");\n        prism.highlightAll();\n    },[])\n\n    const blog = results[0]\n\n    return (\n        <div className=\"flex-col items-center justify-center min-h-screen mt-9\">\n            {/* Title */}\n            <div className=\"flex-col items-center justify-start ml-11 md:ml-36 space-y-2\">\n                <h1 className=\"text-5xl font-bold\">{blog[\"title\"]}</h1>\n            </div>\n            <div className=\"flex-col items-center justify-start ml-11 md:ml-36 mt-2\">\n                <p className=\"text-sm font-extralight\"><span className=\"font-normal\">Fecha: </span> {blog[\"published_at\"].slice(0,10)}</p>\n                <p className=\"text-sm font-extralight\"><span className=\"font-normal\">Autor: </span> {blog[\"user\"][\"username\"]}</p>\n            </div>\n            <div className=\"mx-11 md:mx-36 mt-8\">\n                <div className={markdownStyles[\"markdown-body\"]}>\n                    <MDXRemote {...source}/>\n                </div>\n            </div>\n        </div>\n    )\n}\n\n\nexport async function getStaticProps({params}){\n    const article_post = []\n    \n    const req = await fetch(`https://strapi.legisladoresmx.fun/posts`)\n    const result = await req.json()\n \n\n    result.forEach(element => {\n        \n        if(element[\"slug\"] === params.postid){\n            article_post.push(element)\n        }\n    });\n\n    const source = article_post[0][\"content\"]\n    const mdxSource = await serialize(source)\n    \n    return{\n        props:{\n            results:article_post,\n            source:mdxSource\n        },\n        revalidate:3600\n    }\n}\n\nexport async function getStaticPaths(){\n    const req = await fetch(\"https://strapi.legisladoresmx.fun/posts\")\n    const result = await req.json()\n    \n    return{\n        paths: result.map(posts=>{\n            return{\n                params:{\n                    postid:posts.slug\n                }\n            }\n            }\n        ),\n        fallback:false\n    }\n}\n```\n### 5.4 Landing Page\nNuestro Landing Pages desplegará unas tarjetas con los nombres de los artículos para que los usuarios puedan escoger que leer.\n\nEste es un ejemplo del código que yo utilice en mi sitio,\n```js\n//index.js\nimport Blogcard from \"../components/Blogcard\"\n\nexport default function Blog({postdata}) {\n    const lineOfPosts = postdata\n    return (\n        <div>                \n            <div className='flex justify-center mt-0 bg-gradient-to-r from-green-400 to-blue-500 py-16 sticky'>\n                <h1 className='text-3xl font-extrabold tracking-tight sm:text-4xl md:text-[4rem] md:leading-[3.5rem] text-white'>Blog.</h1>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 place-content-center place-items-center mx-3 mt-6 gap-3\">\n                {lineOfPosts.map(({title, created_at, description, slug})=>\n                    <Blogcard key={slug} title={title} date={created_at} subTitle={description} href={`/tech/${slug}`}/>\n                )}\n            </div>\n        </div>\n    )\n}\n\nexport async function getStaticProps(){\n    const cmspath = \"https://strapi.legisladoresmx.fun/Posts\"\n    const posts = await fetch (`${cmspath}`).then(r=>r.json())\n\n    return{\n        props:{\n            postdata:posts\n        }\n    }\n}\n```\n### 5.5 `BlogCard` Component\nEste componete lo diseñe para desplegar el contenido de las tarjetas que tengo en mi *Landing Page*.\nAquí un ejemplo del código\n```js\nimport Link from \"next/link\"\n\nexport default function Blogcard({title,date,subTitle, href}) {\n\n    return (\n        <main className=\"w-full flex justify-center\">\n            <div className=\"p-3 space-y-2 rounded-lg border border-gray-400 bg-white shadow-md\">\n                <section className=\"text-sm font-thin text-orange-400 text-gray-400\">\n                    Published On:&nbsp;\n                    {date}\n                </section>\n                <section className=\"text-3xl font-bold text-black pb-2\">\n                    {title}\n                </section>\n                <section className=\"font-normal text-md text-gray-700\">\n                    {subTitle}\n                </section>\n                <section className=\"flex justify-end\">\n                    <Link href={href}>\n                        <a>\n                            <button type=\"button\" className=\"bg-gray-600 text-white px-3 py-1 rounded-md\">Read more</button>\n                        </a>\n                    </Link>\n                </section>\n            </div>\n        </main>\n    )\n}\n```\n\n## 6 Build Container\nCrear una imagen de Docker con el código recomendado por [Vercel](https://nextjs.org/docs/deployment). Este código irá en un `Dockerfile` en el root folder de nuestro proyecto.\n\nEl siguiente paso es generar nuestro contenedor y activarlo\n\n```shell\ndocker build . -t my-next-js-app\ndocker run -p 3000:3000 my-next-js-app\n```\nUna vez que corra todo el proceso, nuestra aplicación estará lista y corriendo en nuestra VM.\n\n## 7 NGINX  - Reverse Proxy\nUn *reverse proxy* se usa para muchas cosas. En nuestro caso particular, al tener corriendo nuestro proyecto en un Docker contatiner, podemos tener la flexibilidad de tomar el tráfico que llega a nuestra IP  y manndarlo a nuestro contenedor. \n\n### 7.1 Install NGINX on the VM\n\n```bash\napt install nginx\nsystemctl status nginx\n```\n\n### 7.2 Re-arrange the proxy files \nDentro de la VM visitar `/etc/nginx/sites-enabled ` y agregar el siguiente código\n\n```shell\nserver {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n\n        server_name blog.gerardom.xyz ;\n\n        location / {\n                proxy_pass http://0.0.0.0:3000;\n\t\tproxy_set_header HOST $host;\n        }\n}\n```\n\n```shell\nsudo apt install certbot python3-certbot-nginx\nsudo certbot --nginx -d blog.gerardom.xyz\ncertbot renew --dry-run\n```\n\nEsta es la configuración básica para crear el tunel. El proxy funciona de la siguiente forma. El usuario solicita nuestra URL. El proxy recibe esta señal y la re-enruta a nuestro Docker Container.\n\nPodemos tener varios contendores corriendo simultaneamente y re-enrutarlos todos con estos tuneles. Aqui un ejemplo de como agregaríamos un tunel adicional para una app de FastAPI, por ejemplo.\n\nDentro de  `/etc/nginx/sites-enabled ` agregar un file adicional con el nombre que quieras y colocar el siguiente código.\n\n```bash\nserver{  \n    listen 80;\n    listen [::]:80;\n    \n    server_name twitch.gmarr.com;\n\n\tlocation / {\n\t\tproxy_pass http://0.0.0.0:6000;\n\t\tproxy_set_header HOST $host;\n# These are the critical headers needed by uvicorn to honor HTTPS in url_for :\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Proto $scheme;\n\t}\n\n}\n```\n\nAquí algunos comandos adicionales para revisar nginx.\n\n```shell\n lsof -i -P | grep LISTEN \nsystemctl restart nginx\nsystemctl reload nginx\n```\n","slug":"deploy-nextjs-con-docker","published_at":"2021-12-20T03:46:08.283Z","created_at":"2021-12-20T01:44:58.866Z","updated_at":"2021-12-20T16:51:03.010Z","user":{"id":1,"username":"gmarr","email":"me@gmarr.com","provider":"local","confirmed":true,"blocked":false,"role":1,"created_at":"2021-09-27T19:44:38.166Z","updated_at":"2021-09-27T19:46:35.202Z"}}],"source":{"compiledSource":"var d=Object.defineProperty,m=Object.defineProperties;var u=Object.getOwnPropertyDescriptors;var s=Object.getOwnPropertySymbols;var n=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;var i=(a,r,t)=>r in a?d(a,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[r]=t,e=(a,r)=>{for(var t in r||(r={}))n.call(r,t)&&i(a,t,r[t]);if(s)for(var t of s(r))l.call(r,t)&&i(a,t,r[t]);return a},p=(a,r)=>m(a,u(r));var c=(a,r)=>{var t={};for(var o in a)n.call(a,o)&&r.indexOf(o)<0&&(t[o]=a[o]);if(a!=null&&s)for(var o of s(a))r.indexOf(o)<0&&l.call(a,o)&&(t[o]=a[o]);return t};const layoutProps={},MDXLayout=\"wrapper\";function MDXContent(t){var o=t,{components:a}=o,r=c(o,[\"components\"]);return mdx(MDXLayout,p(e(e({},layoutProps),r),{components:a,mdxType:\"MDXLayout\"}),mdx(\"h2\",null,\"1. Linode\"),mdx(\"p\",null,\"Para este proyecto voy a utilizar una VM de Linode. Ya que la generamos tomamos el IP y nos conectamos a la VM a trav\\xE9s de VS Code. Yo utilizo un plugin llamado \",mdx(\"inlineCode\",{parentName:\"p\"},\"Remote Explorer\"),\" para hacer esto.\"),mdx(\"h2\",null,\"2. Docker\"),mdx(\"p\",null,\"Ya que tenemos acceso a nuestra VM, debemos de instalar Docker. Docker es nos ayuda a crear contendores para nuestras aplicaciones.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),` sudo apt-get update\n sudo apt-get install \\\\\n    ca-certificates \\\\\n    curl \\\\\n    gnupg \\\\\n    lsb-release\n\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n\necho \\\\\n  \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \\\\\n  $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n\n sudo apt-get update\n sudo apt-get install docker-ce docker-ce-cli containerd.io\n\n sudo curl -L \"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose\n\nsudo chmod +x /usr/local/bin/docker-compose\n\ndocker-compose --version\n`)),mdx(\"h2\",null,\"4 Node\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),`curl -fsSL https://deb.nodesource.com/setup_current.x | sudo -E bash -\nsudo apt-get install -y nodejs\nnpm install --global yarn\n`)),mdx(\"h2\",null,\"5 nextJS\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),`npx create-next-app -e with-tailwindcss ejemplo-blog\n`)),mdx(\"h3\",null,\"5.1 Estilos de Markdown\"),mdx(\"p\",null,mdx(\"a\",e({parentName:\"p\"},{href:\"https://github.com/sindresorhus/github-markdown-css\"}),mdx(\"strong\",{parentName:\"a\"},\"Este\")),\" repo de Github contiene los archivos necesarios para agregarle estilo a un archivo de markdown. Especificamente para este ejemplo, utilice el archivo llamado \",mdx(\"inlineCode\",{parentName:\"p\"},\"github-markdown.css\")),mdx(\"p\",null,\"Adicional, para agregar color a los bloques de c\\xF3digo escritos con markdown (a lo que se le conoce como highlight syntax) utilizaremos la librer\\xEDa \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://prismjs.com/\"}),mdx(\"strong\",{parentName:\"a\"},\"Prism\")),\". Existen muchos paquetes que se basan en esta liber\\xEDa. Este proyecto, al ser de React, puede aprovecharse de esta librer\\xEDa: \"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),`yarn add prismjs\n`)),mdx(\"p\",null,\"Nuestro CMS regresa unn \",mdx(\"em\",{parentName:\"p\"},\"string\"),\" de texto en formato \",mdx(\"em\",{parentName:\"p\"},\"markdown\"),\" para este sitio tenemos que tomar esta informaci\\xF3n y connvertirla en HTML. Para este proceos (que se le conoce como \",mdx(\"em\",{parentName:\"p\"},\"parsing\"),\"), utilizaremos un paquete que se llama \\xB4next-mdx-remote\\xB4  que esta basado en la popular librer\\xEDa de markdown \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://mdxjs.com/docs/getting-started/\"}),\"MDX\"),\". \"),mdx(\"p\",null,\"Este es el paquete:\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),`yarn add next-mdx-remote\n`)),mdx(\"h4\",null,\"5.1.1 Agregar Prsim a nuestro archivo\"),mdx(\"p\",null,\"En el archivo \",mdx(\"inlineCode\",{parentName:\"p\"},\"_app.js\"),\" agregar lo siguiente\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-js\"}),`//_app.js\n\nimport \"prismjs/themes/prism.css\";\n`)),mdx(\"h3\",null,\"5.2 Componentes\"),mdx(\"p\",null,\"Esta es la estructura b\\xE1sica de archivos con la que estaremos trabajando en este proyecto.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{}),`+-- components\n|   \\u2514-- Blogcard.js\n\\u2514-- pages\n|   \\u2514-- blog\n|   |  \\u2514-- [postid].js\n|   |  \\u2514-- markdown-styles.module.css\n|   \\u2514-- index.js\n|   \\u2514-- _app.js\n`)),mdx(\"p\",null,\"Crearemos una carpeta que se llama \",mdx(\"inlineCode\",{parentName:\"p\"},\"components\"),\".\"),mdx(\"h3\",null,\"5.3 Creando archivos de forma din\\xE1mica\"),mdx(\"p\",null,`NextJS permite crear p\\xE1ginas de forma din\\xE1mica. En nuestro caso, vamos a tener todos los art\\xEDculos de nuestro blog en un CMS, y vamos a generar una p\\xE1gina por art\\xEDculo.\nEn nuestra estructura de archivos, tenemos un archivo llamado `,mdx(\"inlineCode\",{parentName:\"p\"},\"[postid].js\"),\" dentro de este archvio colocamos el siguiente c\\xF3digo.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-js\"}),`//[postid].js\nimport markdownStyles from './markdown-styles.module.css'\nimport {serialize} from \"next-mdx-remote/serialize\"\nimport { MDXRemote } from \"next-mdx-remote\"\nimport { useEffect } from \"react\"\n\nconst prism = require(\"prismjs\")\nrequire(\"prismjs/components/prism-python\")\nrequire(\"prismjs/components/prism-bash\")\nrequire(\"prismjs/components/prism-json\")\n\nexport default function Movies({results,source}) {\n\n    useEffect(()=>{\n        console.log(\"using effect\");\n        prism.highlightAll();\n    },[])\n\n    const blog = results[0]\n\n    return (\n        <div className=\"flex-col items-center justify-center min-h-screen mt-9\">\n            {/* Title */}\n            <div className=\"flex-col items-center justify-start ml-11 md:ml-36 space-y-2\">\n                <h1 className=\"text-5xl font-bold\">{blog[\"title\"]}</h1>\n            </div>\n            <div className=\"flex-col items-center justify-start ml-11 md:ml-36 mt-2\">\n                <p className=\"text-sm font-extralight\"><span className=\"font-normal\">Fecha: </span> {blog[\"published_at\"].slice(0,10)}</p>\n                <p className=\"text-sm font-extralight\"><span className=\"font-normal\">Autor: </span> {blog[\"user\"][\"username\"]}</p>\n            </div>\n            <div className=\"mx-11 md:mx-36 mt-8\">\n                <div className={markdownStyles[\"markdown-body\"]}>\n                    <MDXRemote {...source}/>\n                </div>\n            </div>\n        </div>\n    )\n}\n\n\nexport async function getStaticProps({params}){\n    const article_post = []\n    \n    const req = await fetch(\\`https://strapi.legisladoresmx.fun/posts\\`)\n    const result = await req.json()\n \n\n    result.forEach(element => {\n        \n        if(element[\"slug\"] === params.postid){\n            article_post.push(element)\n        }\n    });\n\n    const source = article_post[0][\"content\"]\n    const mdxSource = await serialize(source)\n    \n    return{\n        props:{\n            results:article_post,\n            source:mdxSource\n        },\n        revalidate:3600\n    }\n}\n\nexport async function getStaticPaths(){\n    const req = await fetch(\"https://strapi.legisladoresmx.fun/posts\")\n    const result = await req.json()\n    \n    return{\n        paths: result.map(posts=>{\n            return{\n                params:{\n                    postid:posts.slug\n                }\n            }\n            }\n        ),\n        fallback:false\n    }\n}\n`)),mdx(\"h3\",null,\"5.4 Landing Page\"),mdx(\"p\",null,\"Nuestro Landing Pages desplegar\\xE1 unas tarjetas con los nombres de los art\\xEDculos para que los usuarios puedan escoger que leer.\"),mdx(\"p\",null,\"Este es un ejemplo del c\\xF3digo que yo utilice en mi sitio,\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-js\"}),`//index.js\nimport Blogcard from \"../components/Blogcard\"\n\nexport default function Blog({postdata}) {\n    const lineOfPosts = postdata\n    return (\n        <div>                \n            <div className='flex justify-center mt-0 bg-gradient-to-r from-green-400 to-blue-500 py-16 sticky'>\n                <h1 className='text-3xl font-extrabold tracking-tight sm:text-4xl md:text-[4rem] md:leading-[3.5rem] text-white'>Blog.</h1>\n            </div>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 place-content-center place-items-center mx-3 mt-6 gap-3\">\n                {lineOfPosts.map(({title, created_at, description, slug})=>\n                    <Blogcard key={slug} title={title} date={created_at} subTitle={description} href={\\`/tech/\\${slug}\\`}/>\n                )}\n            </div>\n        </div>\n    )\n}\n\nexport async function getStaticProps(){\n    const cmspath = \"https://strapi.legisladoresmx.fun/Posts\"\n    const posts = await fetch (\\`\\${cmspath}\\`).then(r=>r.json())\n\n    return{\n        props:{\n            postdata:posts\n        }\n    }\n}\n`)),mdx(\"h3\",null,\"5.5 \",mdx(\"inlineCode\",{parentName:\"h3\"},\"BlogCard\"),\" Component\"),mdx(\"p\",null,\"Este componete lo dise\\xF1e para desplegar el contenido de las tarjetas que tengo en mi \",mdx(\"em\",{parentName:\"p\"},\"Landing Page\"),`.\nAqu\\xED un ejemplo del c\\xF3digo`),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-js\"}),`import Link from \"next/link\"\n\nexport default function Blogcard({title,date,subTitle, href}) {\n\n    return (\n        <main className=\"w-full flex justify-center\">\n            <div className=\"p-3 space-y-2 rounded-lg border border-gray-400 bg-white shadow-md\">\n                <section className=\"text-sm font-thin text-orange-400 text-gray-400\">\n                    Published On:&nbsp;\n                    {date}\n                </section>\n                <section className=\"text-3xl font-bold text-black pb-2\">\n                    {title}\n                </section>\n                <section className=\"font-normal text-md text-gray-700\">\n                    {subTitle}\n                </section>\n                <section className=\"flex justify-end\">\n                    <Link href={href}>\n                        <a>\n                            <button type=\"button\" className=\"bg-gray-600 text-white px-3 py-1 rounded-md\">Read more</button>\n                        </a>\n                    </Link>\n                </section>\n            </div>\n        </main>\n    )\n}\n`)),mdx(\"h2\",null,\"6 Build Container\"),mdx(\"p\",null,\"Crear una imagen de Docker con el c\\xF3digo recomendado por \",mdx(\"a\",e({parentName:\"p\"},{href:\"https://nextjs.org/docs/deployment\"}),\"Vercel\"),\". Este c\\xF3digo ir\\xE1 en un \",mdx(\"inlineCode\",{parentName:\"p\"},\"Dockerfile\"),\" en el root folder de nuestro proyecto.\"),mdx(\"p\",null,\"El siguiente paso es generar nuestro contenedor y activarlo\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),`docker build . -t my-next-js-app\ndocker run -p 3000:3000 my-next-js-app\n`)),mdx(\"p\",null,\"Una vez que corra todo el proceso, nuestra aplicaci\\xF3n estar\\xE1 lista y corriendo en nuestra VM.\"),mdx(\"h2\",null,\"7 NGINX  - Reverse Proxy\"),mdx(\"p\",null,\"Un \",mdx(\"em\",{parentName:\"p\"},\"reverse proxy\"),\" se usa para muchas cosas. En nuestro caso particular, al tener corriendo nuestro proyecto en un Docker contatiner, podemos tener la flexibilidad de tomar el tr\\xE1fico que llega a nuestra IP  y manndarlo a nuestro contenedor. \"),mdx(\"h3\",null,\"7.1 Install NGINX on the VM\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),`apt install nginx\nsystemctl status nginx\n`)),mdx(\"h3\",null,\"7.2 Re-arrange the proxy files\"),mdx(\"p\",null,\"Dentro de la VM visitar \",mdx(\"inlineCode\",{parentName:\"p\"},\"/etc/nginx/sites-enabled \"),\" y agregar el siguiente c\\xF3digo\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),`server {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n\n        server_name blog.gerardom.xyz ;\n\n        location / {\n                proxy_pass http://0.0.0.0:3000;\n        proxy_set_header HOST $host;\n        }\n}\n`)),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),`sudo apt install certbot python3-certbot-nginx\nsudo certbot --nginx -d blog.gerardom.xyz\ncertbot renew --dry-run\n`)),mdx(\"p\",null,\"Esta es la configuraci\\xF3n b\\xE1sica para crear el tunel. El proxy funciona de la siguiente forma. El usuario solicita nuestra URL. El proxy recibe esta se\\xF1al y la re-enruta a nuestro Docker Container.\"),mdx(\"p\",null,\"Podemos tener varios contendores corriendo simultaneamente y re-enrutarlos todos con estos tuneles. Aqui un ejemplo de como agregar\\xEDamos un tunel adicional para una app de FastAPI, por ejemplo.\"),mdx(\"p\",null,\"Dentro de  \",mdx(\"inlineCode\",{parentName:\"p\"},\"/etc/nginx/sites-enabled \"),\" agregar un file adicional con el nombre que quieras y colocar el siguiente c\\xF3digo.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-bash\"}),`server{  \n    listen 80;\n    listen [::]:80;\n    \n    server_name twitch.gmarr.com;\n\n    location / {\n        proxy_pass http://0.0.0.0:6000;\n        proxy_set_header HOST $host;\n# These are the critical headers needed by uvicorn to honor HTTPS in url_for :\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header   X-Forwarded-Proto $scheme;\n    }\n\n}\n`)),mdx(\"p\",null,\"Aqu\\xED algunos comandos adicionales para revisar nginx.\"),mdx(\"pre\",null,mdx(\"code\",e({parentName:\"pre\"},{className:\"language-shell\"}),` lsof -i -P | grep LISTEN \nsystemctl restart nginx\nsystemctl reload nginx\n`)))}MDXContent.isMDXComponent=!0;\n","scope":{}}},"__N_SSG":true}